<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>EIHO Admin</title>
  <style>
    :root{
      --brand:#0f5ea6;
      --brand-dark:#0b4b85;
      --bg-soft:#f4f7fc;
      --text:#1f2a37;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e6ebf3;
      --field:#d6dbe6;
    }
    *{box-sizing:border-box;}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1100px 400px at -8% -20%, rgba(15,94,166,.14), transparent 62%),
        radial-gradient(860px 340px at 108% 112%, rgba(61,134,209,.12), transparent 60%),
        linear-gradient(180deg,#f6f8fc 0%,#edf2f9 100%);
      margin:0;
      padding:24px;
      color:var(--text);
    }
    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      max-width:1200px;
      margin:0 auto 14px;
      padding:14px 16px;
      border:1px solid var(--border);
      border-radius:16px;
      background:rgba(255,255,255,.88);
      -webkit-backdrop-filter:blur(6px);
      backdrop-filter:blur(6px);
      box-shadow:0 10px 28px rgba(20,37,63,.07);
    }
    .top-title{margin:0;font-size:24px;line-height:1.2;font-weight:900;letter-spacing:.2px;}
    .top-sub{margin:4px 0 0;color:var(--muted);font-size:13px;}
    .top-links{display:flex;align-items:center;gap:8px;white-space:nowrap;}
    .top-links .dot{color:#9aa8bb;}
    .wrap{max-width:1200px;margin:0 auto;}
    .card{
      background:var(--card);
      border-radius:18px;
      padding:18px;
      box-shadow:0 20px 50px rgba(16,31,56,.08);
      border:1px solid var(--border);
    }
    .card-title{margin:0 0 8px;font-size:18px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
    .full{grid-column:1/-1;}
    .section{
      border:1px solid var(--border);
      border-radius:16px;
      margin-bottom:16px;
      background:var(--card);
      box-shadow:0 8px 26px rgba(31,42,55,.04);
      overflow:hidden;
    }
    .section summary{
      cursor:pointer;
      font-weight:800;
      font-size:16px;
      padding:14px 16px;
      list-style:none;
      background:linear-gradient(180deg,#f9fbff 0%,#f3f7fd 100%);
      border-bottom:1px solid var(--border);
    }
    .section summary::-webkit-details-marker{display:none;}
    .section-body{padding:2px 16px 16px;}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin:0;}
    label{font-weight:700;color:#273244;font-size:13px;}
    input,textarea{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--field);
      border-radius:12px;
      margin-top:6px;
      background:#fff;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,textarea:focus{
      outline:none;
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(15,94,166,.12);
    }
    textarea{min-height:92px;resize:vertical;}
    textarea.textarea-tall{min-height:160px;}
    .form-actions{display:flex;gap:10px;align-items:center;}
    .btn{
      padding:10px 14px;
      border:0;
      border-radius:12px;
      background:linear-gradient(135deg,var(--brand) 0%,#2d79c5 100%);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      transition:transform .06s ease,box-shadow .2s ease, background .2s ease;
    }
    .btn:hover{
      background:linear-gradient(135deg,var(--brand-dark) 0%,var(--brand) 100%);
      box-shadow:0 8px 20px rgba(15,94,166,.25);
    }
    .btn:active{transform:translateY(1px);}
    .btn-outline{background:#fff;color:var(--brand);border:1px solid var(--brand);}
    .btn-outline:hover{color:#fff;}
    .btn-danger{background:#fff;color:#c62828;border:1px solid #c62828;}
    .btn-danger:hover{background:#c62828;color:#fff;box-shadow:none;}
    .hint{color:#5f6d82;font-size:12px;margin-top:4px;}
    a{color:var(--brand);text-decoration:none;font-weight:700;}
    a:hover{text-decoration:underline;}
    .item-row{
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      margin-top:10px;
      background:linear-gradient(180deg,#fbfdff 0%,#f8fbff 100%);
    }
    .item-fields{display:grid;grid-template-columns:1fr 2fr 1fr;gap:10px;}
    .item-fields.compact{grid-template-columns:1fr 1fr 2fr;}
    .item-fields.simple{grid-template-columns:1fr 2fr;}
    .item-fields.one{grid-template-columns:1fr;}
    .item-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:8px;}
    .item-actions .btn{padding:6px 10px;font-weight:700;}
    .subpage-hint{
      margin-top:8px;
      padding:8px 10px;
      border:1px dashed #cddcf3;
      border-radius:10px;
      background:#f8fbff;
      font-size:12px;
      color:#4b5b70;
    }
    .news-wrap{margin-top:18px;}
    .news-meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;font-size:12px;color:#6b7280;}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#3f51b5;font-weight:700;font-size:11px;}
    .news-panel{border:1px solid #dce6f6;border-radius:14px;background:#f8fbff;padding:12px;margin-top:10px;box-shadow:0 8px 24px rgba(31,42,55,.03);}
    .news-panel-title{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
    .news-panel-title h4{margin:0;font-size:17px;}
    .news-create{background:#fff;border:1px solid #dfe7f3;}
    .news-create-title{margin:0 0 4px;font-size:18px;color:#1f2a37;}
    .news-create-subtitle{margin:0 0 12px;color:#667085;font-size:13px;}
    .news-create-grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;}
    .news-main-fields{display:grid;grid-template-columns:1fr;gap:12px;}
    .news-side-panel{display:grid;grid-template-columns:1fr;gap:10px;align-content:start;}
    .news-upload-card{
      border:1px solid #dbe5f3;
      border-radius:10px;
      background:#f9fbff;
      padding:10px;
    }
    .news-upload-card label{display:block;margin-bottom:4px;}
    .news-publish-check{display:flex;align-items:center;gap:6px;font-size:13px;color:#374151;margin-top:6px;}
    .news-publish-check input[type="checkbox"]{width:auto;margin:0;}
    .news-create .item-actions{margin-top:12px;justify-content:flex-start;}
    .news-list-wrap{display:grid;gap:10px;}
    .news-item{background:#fff;border:1px solid #dfe7f3;}
    .news-item-grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:8px;}
    .news-side-fields{display:grid;gap:10px;align-content:start;}
    .news-publish-inline{display:flex;align-items:center;gap:6px;font-size:13px;color:#374151;margin-top:6px;}
    .news-publish-inline input[type="checkbox"]{width:auto;margin:0;}
    .news-item .item-actions{border-top:1px solid #eef2f8;padding-top:10px;margin-top:10px;}
    @media (max-width: 900px){
      body{padding:14px;}
      .top{padding:12px;}
      .top-title{font-size:20px;}
      .top-links{font-size:13px;}
      .grid{grid-template-columns:1fr;}
      .item-fields,.item-fields.compact,.item-fields.simple{grid-template-columns:1fr;}
      .news-create-grid{grid-template-columns:1fr;}
      .news-item-grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="top">
    <div>
      <h2 class="top-title">主页内容管理</h2>
      <p class="top-sub">统一维护导航、内容模块、新闻与公司信息。</p>
    </div>
    <div class="top-links">
      <a href="/api/public/home" target="_blank">查看 public JSON</a>
      <span class="dot">|</span>
      <a href="/admin/logout">退出</a>
    </div>
  </div>

  <div class="wrap">
    <form method="post" action="/admin/save">
      <details class="section" open>
        <summary><span class="section-title">导航栏</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="nav_brand_text">品牌文字</label>
              <input id="nav_brand_text" name="nav_brand_text" value="{{ home.nav_brand_text or '' }}" placeholder="EIHO / 衛宝">
            </div>
            <div>
              <label for="nav_top_text">顶部</label>
              <input id="nav_top_text" name="nav_top_text" value="{{ home.nav_top_text or '' }}" placeholder="トップ">
            </div>
            <div>
              <label for="nav_concept_text">メッセージ</label>
              <input id="nav_concept_text" name="nav_concept_text" value="{{ home.nav_concept_text or '' }}" placeholder="メッセージ">
            </div>
            <div>
              <label for="nav_news_text">ニュース</label>
              <input id="nav_news_text" name="nav_news_text" value="{{ home.nav_news_text or '' }}" placeholder="ニュース">
            </div>
            <div>
              <label for="nav_services_text">事業内容</label>
              <input id="nav_services_text" name="nav_services_text" value="{{ home.nav_services_text or '' }}" placeholder="事業内容">
            </div>
            <div>
              <label for="nav_strengths_text">強み</label>
              <input id="nav_strengths_text" name="nav_strengths_text" value="{{ home.nav_strengths_text or '' }}" placeholder="強み">
            </div>
            <div>
              <label for="nav_profile_text">会社概要</label>
              <input id="nav_profile_text" name="nav_profile_text" value="{{ home.nav_profile_text or '' }}" placeholder="会社概要">
            </div>
            <div>
              <label for="nav_cta_text">CTA</label>
              <input id="nav_cta_text" name="nav_cta_text" value="{{ home.nav_cta_text or '' }}" placeholder="お問合わせ">
            </div>
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary><span class="section-title">Hero / 顶部</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="hero_kicker">Hero 角标</label>
              <input id="hero_kicker" name="hero_kicker" value="{{ home.hero_kicker or '' }}" placeholder="Japan × China | Automotive Trading">
            </div>
            <div class="full">
              <label for="hero_title">Hero 标题</label>
              <input id="hero_title" name="hero_title" value="{{ home.hero_title or '' }}" placeholder="例：品質と情熱で、日中のカーライフを繋ぐ架け橋へ">
            </div>
            <div class="full">
              <label for="hero_subtitle">Hero 副文案</label>
              <textarea id="hero_subtitle" name="hero_subtitle" placeholder="例：株式会社衛宝は…">{{ home.hero_subtitle or '' }}</textarea>
            </div>
            <div>
              <label for="hero_primary_cta">主按钮文案</label>
              <input id="hero_primary_cta" name="hero_primary_cta" value="{{ home.hero_primary_cta or '' }}" placeholder="事業内容を見る">
            </div>
            <div>
              <label for="hero_secondary_cta">副按钮文案</label>
              <input id="hero_secondary_cta" name="hero_secondary_cta" value="{{ home.hero_secondary_cta or '' }}" placeholder="会社概要">
            </div>
            <div class="full">
              <label for="hero_bg_image">Hero 背景图（URL 或路径）</label>
              <input id="hero_bg_image" name="hero_bg_image" value="{{ home.hero_bg_image or '' }}" placeholder="https://…">
              <div class="hint">建议用 URL。后续要支持上传图片也可以加接口。</div>
            </div>
          </div>
          <div class="full">
            <h4>Hero 统计卡片（可多条）</h4>
            <div class="hint">每条包含「数字」「后缀」「说明」</div>
            <div id="heroStatsList">
              {% if hero_stats and hero_stats|length > 0 %}
                {% for s in hero_stats %}
                  <div class="item-row">
                    <div class="item-fields compact">
                      <div>
                        <label>数字</label>
                        <input name="hero_stat_value" value="{{ s.value }}" placeholder="2">
                      </div>
                      <div>
                        <label>后缀</label>
                        <input name="hero_stat_suffix" value="{{ s.suffix }}" placeholder="国間">
                      </div>
                      <div>
                        <label>说明</label>
                        <input name="hero_stat_label" value="{{ s.label }}" placeholder="日中の調達・販売を一気通貫">
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="item-row">
                  <div class="item-fields compact">
                    <div>
                      <label>数字</label>
                      <input name="hero_stat_value" value="" placeholder="2">
                    </div>
                    <div>
                      <label>后缀</label>
                      <input name="hero_stat_suffix" value="" placeholder="国間">
                    </div>
                    <div>
                      <label>说明</label>
                      <input name="hero_stat_label" value="" placeholder="日中の調達・販売を一気通貫">
                    </div>
                  </div>
                  <div class="item-actions">
                    <button type="button" class="btn btn-danger" data-remove>删除</button>
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="item-actions">
              <button type="button" class="btn btn-outline" data-add-hero-stat>+ 添加统计卡片</button>
            </div>
          </div>
        </div>
      </details>

      <details class="section">
        <summary><span class="section-title">概念 / Mission / Vision / Value</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="concept_title">区块标题</label>
              <input id="concept_title" name="concept_title" value="{{ home.concept_title or '' }}" placeholder="メッセージ（コンセプト）">
            </div>
            <div class="full">
              <label for="concept_subtitle">区块描述</label>
              <textarea id="concept_subtitle" name="concept_subtitle">{{ home.concept_subtitle or '' }}</textarea>
            </div>
          </div>
          <div class="full">
            <h4>三条要点</h4>
            <div class="hint">每条包含「标题」「说明」</div>
            <div id="conceptPointsList">
              {% if concept_points and concept_points|length > 0 %}
                {% for p in concept_points %}
                  <div class="item-row">
                    <div class="item-fields simple">
                      <div>
                        <label>标题</label>
                        <input name="concept_point_label" value="{{ p.label }}" placeholder="安心">
                      </div>
                      <div>
                        <label>说明</label>
                        <textarea name="concept_point_body" placeholder="検品・規格・品質の可視化">{{ p.body }}</textarea>
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="item-row">
                  <div class="item-fields simple">
                    <div>
                      <label>标题</label>
                      <input name="concept_point_label" value="" placeholder="安心">
                    </div>
                    <div>
                      <label>说明</label>
                      <textarea name="concept_point_body" placeholder="検品・規格・品質の可視化"></textarea>
                    </div>
                  </div>
                  <div class="item-actions">
                    <button type="button" class="btn btn-danger" data-remove>删除</button>
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="item-actions">
              <button type="button" class="btn btn-outline" data-add-concept-point>+ 添加要点</button>
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="mission_title">Mission 标题</label>
              <input id="mission_title" name="mission_title" value="{{ home.mission_title or '' }}" placeholder="Mission">
            </div>
            <div>
              <label for="vision_title">Vision 标题</label>
              <input id="vision_title" name="vision_title" value="{{ home.vision_title or '' }}" placeholder="Vision">
            </div>
            <div>
              <label for="mission_body">Mission 内容</label>
              <textarea id="mission_body" name="mission_body">{{ home.mission_body or '' }}</textarea>
            </div>
            <div>
              <label for="vision_body">Vision 内容</label>
              <textarea id="vision_body" name="vision_body">{{ home.vision_body or '' }}</textarea>
            </div>
            <div>
              <label for="value_title">Value 标题</label>
              <input id="value_title" name="value_title" value="{{ home.value_title or '' }}" placeholder="Value">
            </div>
            <div>
              <label for="value_body">Value 内容</label>
              <textarea id="value_body" name="value_body">{{ home.value_body or '' }}</textarea>
            </div>
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary><span class="section-title">ニュース管理</span></summary>
        <div class="section-body">
          <div class="hint">主页只显示已发布新闻标题，点击进入详情页。</div>
          <div class="news-panel">
            <div class="news-panel-title">
              <h4>新建ニュース</h4>
              <span class="hint">填写完成后点击创建</span>
            </div>
            <div class="item-row news-create">
              <p class="news-create-subtitle">先完成标题和正文，再设置图片、附件和发布状态。</p>
              <div class="news-create-grid">
                <div class="news-main-fields">
                  <div>
                    <label>标题</label>
                    <input name="title" placeholder="例：展示会出展のお知らせ" title="新闻标题">
                  </div>
                  <div>
                    <label>正文</label>
                    <textarea name="body" class="textarea-tall" placeholder="这里输入正文内容" title="新闻正文"></textarea>
                    <div class="hint">建议首段概述核心信息，后续分段补充时间、地点、对象与联系方式。</div>
                  </div>
                </div>
                <div class="news-side-panel">
                  <div class="news-upload-card">
                    <label>图片（可选，多张）</label>
                    <input type="file" name="images" accept="image/*" multiple title="新闻图片">
                  </div>
                  <div class="news-upload-card">
                    <label>附件（可选，多个）</label>
                    <input type="file" name="attachments" multiple title="新闻附件">
                  </div>
                  <div class="news-upload-card">
                    <label>发布状态</label>
                    <label class="news-publish-check"><input type="checkbox" name="is_published" title="发布状态"> 立即发布</label>
                    <div class="hint">未勾选将保存为草稿，可在下方列表中再编辑并发布。</div>
                  </div>
                </div>
              </div>
              <div class="item-actions">
                <button class="btn" type="button" data-news-create>创建</button>
              </div>
            </div>
          </div>

          <div class="news-panel">
            <div class="news-panel-title">
              <h4>已创建ニュース</h4>
              <span class="hint">支持修改后保存或删除</span>
            </div>
            {% if news_items and news_items|length > 0 %}
              <div class="news-list-wrap">
                {% for n in news_items %}
                  <div class="item-row news-item" data-news-id="{{ n.id }}">
                    <div class="news-meta">
                      <span class="badge">ID {{ n.id }}</span>
                      {% if n.is_published %}<span class="badge">公開中</span>{% else %}<span class="badge">非公開</span>{% endif %}
                      <span>详情页：<a href="/news/{{ n.id }}" target="_blank">/news/{{ n.id }}</a></span>
                    </div>
                    <div class="news-item-grid">
                      <div class="item-fields one">
                        <div>
                          <label>标题</label>
                          <input name="title" value="{{ n.title }}" title="新闻标题">
                        </div>
                        <div>
                          <label>正文</label>
                          <textarea name="body" class="textarea-tall" title="新闻正文">{{ n.body or '' }}</textarea>
                        </div>
                      </div>
                      <div class="news-side-fields">
                        <div class="news-upload-card">
                          <label>图片（多张）</label>
                          {% if n.image_paths and n.image_paths|length > 0 %}
                            <div class="hint">当前图片：</div>
                            {% for img in n.image_paths %}
                              <div class="hint"><a href="{{ img }}" target="_blank">图片 {{ loop.index }}</a></div>
                            {% endfor %}
                          {% endif %}
                          <input type="file" name="images" accept="image/*" multiple title="新闻图片">
                        </div>
                        <div class="news-upload-card">
                          <label>附件（多个）</label>
                          {% if n.file_paths and n.file_paths|length > 0 %}
                            <div class="hint">当前附件：</div>
                            {% for f in n.file_paths %}
                              <div class="hint"><a href="{{ f.url }}" target="_blank">{{ f.name }}</a></div>
                            {% endfor %}
                          {% endif %}
                          <input type="file" name="attachments" multiple title="新闻附件">
                        </div>
                        <div class="news-upload-card">
                          <label>发布状态</label>
                          <label class="news-publish-inline">
                            <input type="checkbox" name="is_published" title="发布状态" {% if n.is_published %}checked{% endif %}> 已发布
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="item-actions">
                      <button class="btn btn-outline" type="button" data-news-update>保存</button>
                      <button class="btn btn-danger" type="button" data-news-delete>删除</button>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="hint">暂无新闻</div>
            {% endif %}
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary><span class="section-title">Services</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="services_section_title">区块标题</label>
              <input id="services_section_title" name="services_section_title" value="{{ home.services_section_title or '' }}" placeholder="事業内容（Our Services）">
            </div>
            <div class="full">
              <label for="services_section_subtitle">区块描述</label>
              <textarea id="services_section_subtitle" name="services_section_subtitle">{{ home.services_section_subtitle or '' }}</textarea>
            </div>
          </div>
          <div class="full">
            <div class="hint">可新增/删除多条服务，每条包含「标题」「内容」「图标（可选）」「详情页正文」「多图」「多文件」。</div>
            <div id="servicesList">
              {% if services and services|length > 0 %}
                {% for s in services %}
                  <div class="item-row">
                    <div class="subpage-hint">子页面链接：<a href="/services/{{ loop.index0 }}" target="_blank">/services/{{ loop.index0 }}</a>（保存后生效）</div>
                    <div class="item-fields">
                      <div>
                        <label>标题</label>
                        <input name="services_title" value="{{ s.title }}" placeholder="例如：輸入事業（Import）">
                      </div>
                      <div>
                        <label>内容</label>
                        <textarea name="services_body" placeholder="服务内容">{{ s.body }}</textarea>
                      </div>
                      <div>
                        <label>图标（可选）</label>
                        <input name="services_icon" value="{{ s.icon or '' }}" placeholder="box-seam">
                      </div>
                    </div>
                    <div class="item-fields one">
                      <div>
                        <label>详情页正文（可选）</label>
                        <textarea name="services_detail_body" placeholder="这里填写子页面的详细介绍内容">{{ s.detail_body or '' }}</textarea>
                      </div>
                    </div>
                    <div class="item-fields simple">
                      <div>
                        <label>详情页图片（可选，多张）</label>
                        <textarea name="services_detail_images" placeholder="每行一张图片 URL&#10;https://example.com/a.jpg&#10;https://example.com/b.jpg">{{ (s.detail_images or [])|join('\n') }}</textarea>
                        <div class="hint">也可直接上传本地图片（支持多选）</div>
                        <input type="file" accept="image/*" multiple data-services-images-upload title="上传详情页图片">
                      </div>
                      <div>
                        <label>详情页文件（可选，多个）</label>
                        <textarea name="services_detail_files" placeholder="每行一个文件，格式：名称|URL&#10;产品手册|https://example.com/manual.pdf&#10;报价单|https://example.com/quote.xlsx">{% if s.detail_files and s.detail_files|length > 0 %}{% for f in s.detail_files %}{{ (f.name or '文件') ~ '|' ~ (f.url or '') }}{% if not loop.last %}
{% endif %}{% endfor %}{% endif %}</textarea>
                        <div class="hint">也可直接上传本地文件（支持多选）</div>
                        <input type="file" multiple data-services-files-upload title="上传详情页文件">
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="item-row">
                  <div class="item-fields">
                    <div>
                      <label>标题</label>
                      <input name="services_title" value="" placeholder="例如：輸入事業（Import）">
                    </div>
                    <div>
                      <label>内容</label>
                      <textarea name="services_body" placeholder="服务内容"></textarea>
                    </div>
                    <div>
                      <label>图标（可选）</label>
                      <input name="services_icon" value="" placeholder="box-seam">
                    </div>
                  </div>
                  <div class="item-fields one">
                    <div>
                      <label>详情页正文（可选）</label>
                      <textarea name="services_detail_body" placeholder="这里填写子页面的详细介绍内容"></textarea>
                    </div>
                  </div>
                  <div class="item-fields simple">
                    <div>
                      <label>详情页图片（可选，多张）</label>
                      <textarea name="services_detail_images" placeholder="每行一张图片 URL&#10;https://example.com/a.jpg&#10;https://example.com/b.jpg"></textarea>
                      <div class="hint">也可直接上传本地图片（支持多选）</div>
                      <input type="file" accept="image/*" multiple data-services-images-upload title="上传详情页图片">
                    </div>
                    <div>
                      <label>详情页文件（可选，多个）</label>
                      <textarea name="services_detail_files" placeholder="每行一个文件，格式：名称|URL&#10;产品手册|https://example.com/manual.pdf"></textarea>
                      <div class="hint">也可直接上传本地文件（支持多选）</div>
                      <input type="file" multiple data-services-files-upload title="上传详情页文件">
                    </div>
                  </div>
                  <div class="item-actions">
                    <button type="button" class="btn btn-danger" data-remove>删除</button>
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="item-actions">
              <button type="button" class="btn btn-outline" data-add-service>+ 添加服务</button>
            </div>
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary><span class="section-title">Strengths</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="strengths_section_title">区块标题</label>
              <input id="strengths_section_title" name="strengths_section_title" value="{{ home.strengths_section_title or '' }}" placeholder="当社の強み（Why Choose Us?）">
            </div>
            <div class="full">
              <label for="strengths_section_subtitle">区块描述</label>
              <textarea id="strengths_section_subtitle" name="strengths_section_subtitle">{{ home.strengths_section_subtitle or '' }}</textarea>
            </div>
          </div>
          <div class="full">
            <div class="hint">可新增/删除多条强项，每条包含「标题」「内容」「图标（可选）」</div>
            <div id="strengthsList">
              {% if strengths and strengths|length > 0 %}
                {% for s in strengths %}
                  <div class="item-row">
                    <div class="item-fields">
                      <div>
                        <label>标题</label>
                        <input name="strengths_title" value="{{ s.title }}" placeholder="例如：独自のネットワーク">
                      </div>
                      <div>
                        <label>内容</label>
                        <textarea name="strengths_body" placeholder="强项内容">{{ s.body }}</textarea>
                      </div>
                      <div>
                        <label>图标（可选）</label>
                        <input name="strengths_icon" value="{{ s.icon or '' }}" placeholder="diagram-3-fill">
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="item-row">
                  <div class="item-fields">
                    <div>
                      <label>标题</label>
                      <input name="strengths_title" value="" placeholder="例如：独自のネットワーク">
                    </div>
                    <div>
                      <label>内容</label>
                      <textarea name="strengths_body" placeholder="强项内容"></textarea>
                    </div>
                    <div>
                      <label>图标（可选）</label>
                      <input name="strengths_icon" value="" placeholder="diagram-3-fill">
                    </div>
                  </div>
                  <div class="item-actions">
                    <button type="button" class="btn btn-danger" data-remove>删除</button>
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="item-actions">
              <button type="button" class="btn btn-outline" data-add-strength>+ 添加强项</button>
            </div>
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary><span class="section-title">公司概要</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="profile_title">区块标题</label>
              <input id="profile_title" name="profile_title" value="{{ home.profile_title or '' }}" placeholder="会社概要（Company Profile）">
            </div>
            <div class="full">
              <label for="profile_subtitle">区块描述</label>
              <textarea id="profile_subtitle" name="profile_subtitle">{{ home.profile_subtitle or '' }}</textarea>
            </div>
            <input id="company_name" name="company_name" value="{{ home.company_name or '' }}" hidden>
            <input id="established" name="established" value="{{ home.established or '' }}" hidden>
            <input id="address" name="address" value="{{ home.address or '' }}" hidden>
            <input id="representative" name="representative" value="{{ home.representative or '' }}" hidden>
            <textarea id="business_desc" name="business_desc" hidden>{{ home.business_desc or '' }}</textarea>
            <textarea id="clients" name="clients" hidden>{{ home.clients or '' }}</textarea>
            <div class="full">
              <h4>会社概要表格行（可新增/删除）</h4>
              <div class="hint">统一在这里编辑公司概要，避免重复维护。左侧为项目名，右侧为内容。</div>
              <div id="profileRowsList">
                {% if profile_rows and profile_rows|length > 0 %}
                  {% for row in profile_rows %}
                    <div class="item-row">
                      <div class="item-fields simple">
                        <div>
                          <label>项目名</label>
                          <input name="profile_row_label" value="{{ row.label or '' }}" placeholder="例如：所在地">
                        </div>
                        <div>
                          <label>内容</label>
                          <textarea name="profile_row_value" placeholder="例如：〒000-0000 東京都...">{{ row.value or '' }}</textarea>
                        </div>
                      </div>
                      <div class="item-actions">
                        <button type="button" class="btn btn-danger" data-remove>删除</button>
                      </div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="item-row">
                    <div class="item-fields simple">
                      <div>
                        <label>项目名</label>
                        <input name="profile_row_label" value="名称" placeholder="例如：所在地">
                      </div>
                      <div>
                        <label>内容</label>
                        <textarea name="profile_row_value" placeholder="例如：〒000-0000 東京都...">{{ home.company_name or '' }}</textarea>
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endif %}
              </div>
              <div class="item-actions">
                <button type="button" class="btn btn-outline" data-add-profile-row>+ 添加表格行</button>
              </div>
            </div>
          </div>
        </div>
      </details>

      <details class="section">
        <summary><span class="section-title">Contact / CTA</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="cta_title">CTA 标题</label>
              <input id="cta_title" name="cta_title" value="{{ home.cta_title or '' }}">
            </div>
            <div class="full">
              <label for="cta_subtitle">CTA 副标题</label>
              <textarea id="cta_subtitle" name="cta_subtitle">{{ home.cta_subtitle or '' }}</textarea>
            </div>
            <div>
              <label for="cta_button_text">CTA 按钮文案</label>
              <input id="cta_button_text" name="cta_button_text" value="{{ home.cta_button_text or '' }}">
            </div>
            <div>
              <label for="cta_phone_text">电话说明</label>
              <input id="cta_phone_text" name="cta_phone_text" value="{{ home.cta_phone_text or '' }}">
            </div>
            <div>
              <label for="contact_form_title">表单标题</label>
              <input id="contact_form_title" name="contact_form_title" value="{{ home.contact_form_title or '' }}">
            </div>
            <div>
              <label for="contact_examples_title">咨询示例标题</label>
              <input id="contact_examples_title" name="contact_examples_title" value="{{ home.contact_examples_title or '' }}">
            </div>
            <div class="full">
              <label for="contact_form_note">说明文字</label>
              <textarea id="contact_form_note" name="contact_form_note">{{ home.contact_form_note or '' }}</textarea>
            </div>
            <div class="full">
              <h4>咨询示例列表</h4>
              <div id="contactExamplesList">
                {% if contact_examples and contact_examples|length > 0 %}
                  {% for item in contact_examples %}
                    <div class="item-row">
                      <div class="item-fields one">
                        <div>
                          <label>示例</label>
                          <input name="contact_example_text" value="{{ item }}" placeholder="日本向け：カーアクセサリー...">
                        </div>
                      </div>
                      <div class="item-actions">
                        <button type="button" class="btn btn-danger" data-remove>删除</button>
                      </div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="item-row">
                    <div class="item-fields one">
                      <div>
                        <label>示例</label>
                        <input name="contact_example_text" value="" placeholder="日本向け：カーアクセサリー...">
                      </div>
                    </div>
                    <div class="item-actions">
                      <button type="button" class="btn btn-danger" data-remove>删除</button>
                    </div>
                  </div>
                {% endif %}
              </div>
              <div class="item-actions">
                <button type="button" class="btn btn-outline" data-add-contact-example>+ 添加示例</button>
              </div>
            </div>
            <div>
              <label for="access_title">アクセス标题</label>
              <input id="access_title" name="access_title" value="{{ home.access_title or '' }}">
            </div>
            <div>
              <label for="access_address">アクセス地址</label>
              <input id="access_address" name="access_address" value="{{ home.access_address or '' }}">
            </div>
          </div>
        </div>
      </details>

      <details class="section">
        <summary><span class="section-title">Footer</span></summary>
        <div class="section-body">
          <div class="grid">
            <div class="full">
              <label for="footer_copyright">版权文案</label>
              <input id="footer_copyright" name="footer_copyright" value="{{ home.footer_copyright or '' }}">
            </div>
            <div>
              <label for="footer_link_top">底部链接：TOP</label>
              <input id="footer_link_top" name="footer_link_top" value="{{ home.footer_link_top or '' }}">
            </div>
            <div>
              <label for="footer_link_services">底部链接：Services</label>
              <input id="footer_link_services" name="footer_link_services" value="{{ home.footer_link_services or '' }}">
            </div>
            <div>
              <label for="footer_link_profile">底部链接：Profile</label>
              <input id="footer_link_profile" name="footer_link_profile" value="{{ home.footer_link_profile or '' }}">
            </div>
          </div>
        </div>
      </details>

      <div class="card form-actions">
        <button class="btn" type="submit">保存</button>
        <div class="hint">保存后前端刷新即可看到变化（前端需接入 API 渲染）。</div>
      </div>
    </form>
  </div>

  <template id="serviceItemTpl">
    <div class="item-row">
      <div class="item-fields">
        <div>
          <label>标题</label>
          <input name="services_title" value="" placeholder="例如：輸入事業（Import）" title="服务标题">
        </div>
        <div>
          <label>内容</label>
          <textarea name="services_body" placeholder="服务内容" title="服务内容"></textarea>
        </div>
        <div>
          <label>图标（可选）</label>
          <input name="services_icon" value="" placeholder="box-seam" title="Bootstrap Icons 名称">
        </div>
      </div>
      <div class="item-fields one">
        <div>
          <label>详情页正文（可选）</label>
          <textarea name="services_detail_body" placeholder="这里填写子页面的详细介绍内容" title="详情页正文"></textarea>
        </div>
      </div>
      <div class="item-fields simple">
        <div>
          <label>详情页图片（可选，多张）</label>
          <textarea name="services_detail_images" placeholder="每行一张图片 URL&#10;https://example.com/a.jpg&#10;https://example.com/b.jpg" title="详情页图片"></textarea>
          <div class="hint">也可直接上传本地图片（支持多选）</div>
          <input type="file" accept="image/*" multiple data-services-images-upload title="上传详情页图片">
        </div>
        <div>
          <label>详情页文件（可选，多个）</label>
          <textarea name="services_detail_files" placeholder="每行一个文件，格式：名称|URL&#10;产品手册|https://example.com/manual.pdf" title="详情页文件"></textarea>
          <div class="hint">也可直接上传本地文件（支持多选）</div>
          <input type="file" multiple data-services-files-upload title="上传详情页文件">
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <template id="strengthItemTpl">
    <div class="item-row">
      <div class="item-fields">
        <div>
          <label>标题</label>
          <input name="strengths_title" value="" placeholder="例如：独自のネットワーク" title="强项标题">
        </div>
        <div>
          <label>内容</label>
          <textarea name="strengths_body" placeholder="强项内容" title="强项内容"></textarea>
        </div>
        <div>
          <label>图标（可选）</label>
          <input name="strengths_icon" value="" placeholder="diagram-3-fill" title="Bootstrap Icons 名称">
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <template id="heroStatItemTpl">
    <div class="item-row">
      <div class="item-fields compact">
        <div>
          <label>数字</label>
          <input name="hero_stat_value" value="" placeholder="2">
        </div>
        <div>
          <label>后缀</label>
          <input name="hero_stat_suffix" value="" placeholder="国間">
        </div>
        <div>
          <label>说明</label>
          <input name="hero_stat_label" value="" placeholder="日中の調達・販売を一気通貫">
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <template id="conceptPointTpl">
    <div class="item-row">
      <div class="item-fields simple">
        <div>
          <label>标题</label>
          <input name="concept_point_label" value="" placeholder="安心">
        </div>
        <div>
          <label>说明</label>
          <textarea name="concept_point_body" placeholder="検品・規格・品質の可視化"></textarea>
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <template id="contactExampleTpl">
    <div class="item-row">
      <div class="item-fields one">
        <div>
          <label>示例</label>
          <input name="contact_example_text" value="" placeholder="日本向け：カーアクセサリー...">
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <template id="profileRowTpl">
    <div class="item-row">
      <div class="item-fields simple">
        <div>
          <label>项目名</label>
          <input name="profile_row_label" value="" placeholder="例如：所在地">
        </div>
        <div>
          <label>内容</label>
          <textarea name="profile_row_value" placeholder="例如：〒000-0000 東京都..."></textarea>
        </div>
      </div>
      <div class="item-actions">
        <button type="button" class="btn btn-danger" data-remove>删除</button>
      </div>
    </div>
  </template>

  <script>
    const addItem = (listId, tplId) => {
      const list = document.getElementById(listId);
      const tpl = document.getElementById(tplId);
      if (!list || !tpl) return;
      const node = tpl.content.firstElementChild.cloneNode(true);
      list.appendChild(node);
    };

    document.addEventListener("click", (e) => {
      const el = e.target instanceof Element ? e.target : null;
      if (!el) return;

      if (el.closest("[data-add-service]")) {
        addItem("servicesList", "serviceItemTpl");
      }
      if (el.closest("[data-add-strength]")) {
        addItem("strengthsList", "strengthItemTpl");
      }
      if (el.closest("[data-add-hero-stat]")) {
        addItem("heroStatsList", "heroStatItemTpl");
      }
      if (el.closest("[data-add-concept-point]")) {
        addItem("conceptPointsList", "conceptPointTpl");
      }
      if (el.closest("[data-add-contact-example]")) {
        addItem("contactExamplesList", "contactExampleTpl");
      }
      if (el.closest("[data-add-profile-row]")) {
        addItem("profileRowsList", "profileRowTpl");
      }
      if (el.closest("[data-remove]")) {
        const row = el.closest(".item-row");
        if (row) row.remove();
      }
      if (el.closest("[data-news-create]")) {
        const root = el.closest(".news-create");
        if (!root) return;
        submitNewsForm("/admin/news/create", root);
      }
      if (el.closest("[data-news-update]")) {
        const root = el.closest(".news-item");
        if (!root) return;
        const id = root.getAttribute("data-news-id");
        if (!id) return;
        submitNewsForm(`/admin/news/update/${id}`, root);
      }
      if (el.closest("[data-news-delete]")) {
        const root = el.closest(".news-item");
        if (!root) return;
        const id = root.getAttribute("data-news-id");
        if (!id) return;
        if (!confirm("确定删除此新闻吗？")) return;
        fetch(`/admin/news/delete/${id}`, { method: "POST" })
          .then(() => window.location.reload())
          .catch(() => alert("删除失败，请稍后再试"));
      }
    });

    const appendLines = (textarea, lines) => {
      if (!textarea || !Array.isArray(lines) || lines.length === 0) return;
      const current = (textarea.value || "").trim();
      const next = lines.join("\n");
      textarea.value = current ? `${current}\n${next}` : next;
    };

    const uploadServiceAssets = async (input, kind) => {
      const root = input.closest(".item-row");
      if (!root) return;
      const files = Array.from(input.files || []);
      if (files.length === 0) return;

      const fd = new FormData();
      fd.append("kind", kind);
      files.forEach((file) => fd.append("files", file));

      input.disabled = true;
      try {
        const res = await fetch("/admin/services/upload", {
          method: "POST",
          body: fd
        });
        const data = await res.json();
        if (!res.ok || !data?.ok || !Array.isArray(data.items)) {
          const msg = data?.detail || "上传失败，请稍后再试";
          alert(msg);
          return;
        }

        if (kind === "image") {
          const area = root.querySelector('textarea[name="services_detail_images"]');
          appendLines(area, data.items.map((item) => item.url).filter(Boolean));
        } else {
          const area = root.querySelector('textarea[name="services_detail_files"]');
          appendLines(area, data.items.map((item) => `${item.name || "文件"}|${item.url || ""}`));
        }
      } catch (_) {
        alert("上传失败，请稍后再试");
      } finally {
        input.disabled = false;
        input.value = "";
      }
    };

    document.addEventListener("change", (e) => {
      const el = e.target instanceof Element ? e.target : null;
      if (!el) return;
      if (el.matches("[data-services-images-upload]")) {
        uploadServiceAssets(el, "image");
      }
      if (el.matches("[data-services-files-upload]")) {
        uploadServiceAssets(el, "file");
      }
    });


    const submitNewsForm = (url, root) => {
      const title = root.querySelector('input[name="title"]')?.value?.trim() || "";
      if (!title) {
        alert("请填写标题");
        return;
      }
      const fd = new FormData();
      fd.append("title", title);
      const body = root.querySelector('textarea[name="body"]')?.value || "";
      fd.append("body", body);
      const images = Array.from(root.querySelector('input[name="images"]')?.files || []);
      const attachments = Array.from(root.querySelector('input[name="attachments"]')?.files || []);
      images.forEach((file) => fd.append("images", file));
      attachments.forEach((file) => fd.append("attachments", file));
      const isPublished = root.querySelector('input[name="is_published"]')?.checked;
      if (isPublished) fd.append("is_published", "on");
      fetch(url, { method: "POST", body: fd })
        .then(() => window.location.reload())
        .catch(() => alert("提交失败，请稍后再试"));
    };
  </script>
</body>
</html>
